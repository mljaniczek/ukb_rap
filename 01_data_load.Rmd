---
title: "Untitled"
output: html_document
date: "2025-08-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
system('dx download pheno.csv')
system('dx download first_occurrences.csv')
system('dx download mets.csv')

load("analysis_variable_keys.Rdata")

library(tidyr)

install.packages("readr")


library(readr)


pheno <- read_csv("pheno.csv", name_repair = "universal_quiet")

mets <- read_csv("mets.csv", name_repair = "universal_quiet")

fo <- read_csv("first_occurrences.csv", name_repair = "universal_quiet") 
```

```{r}
# grab columns of occurrence
library(stringr)
library(tidyr)
library(dplyr)

event_key <- colnames(fo)[str_detect(colnames(fo), "Source")]
eventdate_key <- colnames(fo%>% select(-c( Sample.Measured.Date.and.Time...Instance.0)))[str_detect(colnames(fo%>% select(-c(Sample.Measured.Date.and.Time...Instance.0))), "Date")]

event <- fo %>%
  select(Participant.ID, all_of(event_key))

event_date <- fo  %>% select(Participant.ID, all_of(eventdate_key))

# go to longer
event_long <- event %>%
  pivot_longer(!Participant.ID, values_drop_na = TRUE) %>%
  group_by(Participant.ID) %>%
  mutate(id = row_number())

# grab date of first occurence
eventdate_long <- event_date %>%
  pivot_longer(!c(Participant.ID, Date.of.attending.assessment.centre...Instance.0), values_drop_na = TRUE) %>%
  group_by(Participant.ID) %>%
  mutate(id = row_number()) %>%
  mutate(afterassessment_fo = value > Date.of.attending.assessment.centre...Instance.0,
         beforeassessment_fo = value < Date.of.attending.assessment.centre...Instance.0)
```


